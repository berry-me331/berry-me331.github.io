---
layout: single
published: true
title:  "JAVA 언어 : Couse2. Part3 미니프로젝트 (Feat. 시그니처 백엔드 강의)"
---



## 목차

- [Part 4. 자바 리펙토링 및 미니 프로젝트기](#part-4-자바-리펙토링-및-미니-프로젝트)
  * [Ch03. 실전 API 활용하기 (2)](#ch03-실전-api-활용하기-2)
  * [Ch04. 실전 API 활용하기 (3)](#ch03-실전-api-활용하기-3)

## Part 4. 자바 리펙토링 및 미니 프로젝트

### Ch03. 실전 API 활용하기 (2)


<details>
  <summary>
    close()에 관하여
  </summary>

<div markdown="1">
  <br>

* close() 메서드
  - 메모리에 할당된 인스턴스가 아니라 운영체제의 자원(시스템 자원)을 끌어와서 쓰는 스트림을 닫아줌
  - 자바 외부에 있는 것들 File, Writer Document,  Scanner 등등
  - 그러나 API 중에서 자바 외부가 아니어도 Close가 있는 클래스가 있음(개별확인필요-API문서확인)
  
---

</div>
</details>

<details>
  <summary>
    try 예외처리와 try with resourse 정리
  </summary>

<div markdown="1">
  <br>

* try 예외처리와 try with resourse
  : 수업에서 다루지 않은 예외처리에 대해 상세히 알아보기

  - 우선 예외처리는 오류들을 알려주는 건데, 프로그래밍 언어의 문법적 오류의 경우 __에러(Error)__ 실행중 발생하는 오류 __예외(Exception)__ 이라 한다.
  - throw의 경우 예외를 발생시킬때 사용한다.(사용자에게 주의주거나 관련처리해달라고 부탁)
예시는 다음과같다.

```java
if(x<0){
    throw new Error('x는 음수가 아니어야 합니다.')
}
```

  - catch의 경우 try문에서 예외가 발생하면 호출된다
  - finally의 경우 try문에서 예외가 발생하든 안한든 호출된다.
  - 둘 중 하나는 생략될 수 있다. 둘다 생략은 안된다고한다..
  -  `throws IOException`의 경우 예외가 발생하면 해당 클래스에서 벗어나게 된다.
  - try with resourse 는 `try(Writer writer = new FileWriter(fileName))` 이렇게 괄호안에 스트림에 관한 식하나가 추가되고, 끝나면 닫아준다. try문 안에 있는 예외값을 출력해준다. (finally 쪽이나 stream닫을 때 예욋값을 출력해주려면 다른 추가 코드가 필요하다.
  - try with resourse는 try만 써도 무관하다.

  - try대신 throw new 를 쓰기도하는데,
` if (!response.isSuccessful()) throw new IOException("Request failed: " + response); //응답실패시`
응답실패시 예외를 출력해주게 오류를 발생시켜서 알려준다.(어떤 오류인지 알려주기 위해 사용)

* 예외에 관해서
  : Runtime Excetpion은 자잘한거라서 처리 안해도되는오류
  
  - 예외는 Exception으로 나누며 RuntimeException과 그외로 나뉘는데 그중 IOException은 스트림, 파일 및 디렉터리를 사용하여 정보를 엑세스하는동안 throw된 예외에 대한 기본 클래스이다. > 입출력 작업시 발생되는 오류를 말함
  - throws IOExctiopn은 이오류가 났을시 예외처리
  - 예외처리 되면 밑에는 실행되지 않고 보통 로그로 찍힘


---

</div>
</details>



* 프로젝트 명
  : 크롤링하여 PDF 에 책 목록 만들기

  - https://developers.kakao.com 에 로그인해서  API키 받아오기

 - query 웹 서버에 특정한 정보를 보여달라는 웹 클라이언트 요청


<이미지 불러올때>

```java
// 이미지 추가
            try {
                ImageData imageData = ImageDataFactory.create(book.getThumbnail()); //이미지를 데이터에 저장
                Image image = new Image(imageData);
                image.setAutoScale(true);
                table.addCell(new Cell().add(image).setPadding(5));
            } catch (MalformedURLException e) {
                table.addCell(createCell("이미지 불러오기 실패", false));
            }
```

<details>
  <summary>
    2번째 미니 프로젝트 예제
  </summary>

<div markdown="1">
  <br>

  - 총 4개의 클래스로 구성 : Book, BookSearchMain, KakaoBookApi,PdfGenerator
  - 책정보, 책검색 및 실행(스캐너로 제목 입력받음), 카카오에서 정보받아옴(여기가 좀 복잡함), Pdf생성시 폰트필수!!

- Book 클래스

```java
package kr.book.search;

public class Book {
    private String title;
    private String authors;
    private String publisher;
    private String thumbnail; //섬네일

    public Book() {
    }

    public Book(String title, String authors, String publisher, String thumbnail) {
        this.title = title;
        this.authors = authors;
        this.publisher = publisher;
        this.thumbnail = thumbnail;
    }

    @Override
    public String toString() {
        return "Book{" +
                "title='" + title + '\'' +
                ", authors='" + authors + '\'' +
                ", publisher='" + publisher + '\'' +
                ", thumbnail='" + thumbnail + '\'' +
                '}';
    }

    public String getTitle() {
        return title;
    }

    public void setTitle(String title) {
        this.title = title;
    }

    public String getAuthors() {
        return authors;
    }

    public void setAuthors(String authors) {
        this.authors = authors;
    }

    public String getPublisher() {
        return publisher;
    }

    public void setPublisher(String publisher) {
        this.publisher = publisher;
    }

    public String getThumbnail() {
        return thumbnail;
    }

    public void setThumbnail(String thumbnail) {
        this.thumbnail = thumbnail;
    }
}

```

BookSearchMain

```java
package kr.book.search;


import java.io.IOException;
import java.util.List;
import java.util.Scanner;

public class BookSearchMain {
    public static void main(String[] args) {
        try {
            Scanner scanner=new Scanner(System.in);
            System.out.print("도서제목을 입력하세요:");
            String bookTitle = scanner.nextLine();
            List<Book> books = KakaoBookApi.searchBooks(bookTitle);

            if (books.isEmpty()) {
                System.out.println("검색 결과가 없습니다.");
            } else {
                for(Book book : books){
                    System.out.println(book);
                }
                String fileName = "도서목록.pdf";
                PdfGenerator.generateBookListPdf(books, fileName);
                System.out.println(fileName + " 파일이 생성되었습니다.");
            }
        } catch (IOException e) {
            System.err.println("에러가 발생했습니다: " + e.getMessage());
        }
    }
}
```

KakaoBookApi

```java
package kr.book.search;

import com.google.gson.Gson;
import com.google.gson.JsonArray;
import com.google.gson.JsonElement;
import com.google.gson.JsonObject;
import okhttp3.HttpUrl;
import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.Response;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

public class KakaoBookApi {
    //카톡에서 책정보를 가져와서 파싱하는 클래스
    private static final String API_KEY="17fa1916bd7d522da37ebaae29456c85"; //Rest API 키
    //카카오 개발자사이트가서 발급받아서 넣으면됨
    private static final String API_BASE_URL = "https://dapi.kakao.com/v3/search/book";
    private static final OkHttpClient client = new OkHttpClient(); //서버연결할때
    private static final Gson gson = new Gson();

    //책검색 메서드
    // 책검색 메서드
    public static List<Book> searchBooks(String title) throws IOException {
       // 2) throws - 호출한 쪽(부모)에게 예외 처리 위임하도록

        HttpUrl.Builder urlBuilder = HttpUrl.parse(API_BASE_URL).newBuilder(); //URL 생성및 URL연결
        urlBuilder.addQueryParameter("query", title);//query라는 변수에 title을 넘겨줌

        Request request = new Request.Builder()
                .url(urlBuilder.build()) //서버에 요청
                .addHeader("Authorization", "KakaoAK " + API_KEY) //키값 넣어주기 카카오톡 개발자사이트 참조
                .build();
//요청을 어떻게 할건지
        try (Response response = client.newCall(request).execute()) {

            if (!response.isSuccessful()) throw new IOException("Request failed: " + response); //응답실패시

            //Json타입 데이터를 캐릭터 타입으로 만들어서 하나의 JsonObject로 변환하는 클래스
            JsonObject jsonResponse = gson.fromJson(response.body().string(), JsonObject.class);
            //이미 객체타입으로 되어있음
            JsonArray documents = jsonResponse.getAsJsonArray("documents"); //document가 하나의 책정보임

            List<Book> books = new ArrayList<>();
            for (JsonElement document : documents) {
                JsonObject bookJson = document.getAsJsonObject();
                Book book = new Book(
                        bookJson.get("title").getAsString(),
                        bookJson.get("authors").getAsJsonArray().toString(),
                        bookJson.get("publisher").getAsString(),
                        bookJson.get("thumbnail").getAsString()
                );
                books.add(book);
            }
            return books;
        }
    }


}

```

PdfGenerator

```java
package kr.book.search;
import com.itextpdf.kernel.colors.ColorConstants;
import com.itextpdf.kernel.font.PdfFont;
import com.itextpdf.kernel.font.PdfFontFactory;
import com.itextpdf.kernel.pdf.*;
import com.itextpdf.layout.Document;
import com.itextpdf.layout.element.Cell;
import com.itextpdf.layout.element.Image;
import com.itextpdf.layout.element.Paragraph;
import com.itextpdf.layout.element.Table;
import com.itextpdf.layout.property.TextAlignment;
import com.itextpdf.layout.property.UnitValue;
import com.itextpdf.io.font.PdfEncodings;
import com.itextpdf.io.image.ImageData;
import com.itextpdf.io.image.ImageDataFactory;
import java.io.*;
import java.util.*;
import java.net.MalformedURLException;
public class PdfGenerator {
    public static void generateBookListPdf(List<Book> books, String fileName) throws FileNotFoundException {
        PdfWriter writer = new PdfWriter(fileName);
        PdfDocument pdf = new PdfDocument(writer);
        Document document = new Document(pdf);
        document.setFontSize(12);
        // 폰트 생성 및 추가
        PdfFont font=null;
        try {
            font = PdfFontFactory.createFont("HANBatang.ttf", PdfEncodings.IDENTITY_H, true);
        } catch (IOException e1) {
            e1.printStackTrace();
        }
        document.setFont(font);
        // 타이틀 추가
        Paragraph titleParagraph = new Paragraph("도서 목록");
        titleParagraph.setFontSize(24);
        titleParagraph.setTextAlignment(TextAlignment.CENTER);
        titleParagraph.setBold();
        document.add(titleParagraph);

        // 도서 정보 테이블 생성 >>표 생성하는거
        Table table = new Table(UnitValue.createPercentArray(new float[]{2, 2, 2, 2}));
        table.setWidth(UnitValue.createPercentValue(100)); //너비 몇퍼센트 사용(페이지에서)
        table.setMarginTop(20);

        // 테이블 헤더 추가
        table.addHeaderCell(createCell("제목", true));
        table.addHeaderCell(createCell("저자", true));
        table.addHeaderCell(createCell("출판사", true));
        table.addHeaderCell(createCell("이미지", true));

        // 도서 정보를 테이블에 추가
        for (Book book : books) {
            table.addCell(createCell(book.getTitle(), false));
            table.addCell(createCell(book.getAuthors(), false));
            table.addCell(createCell(book.getPublisher(), false));

            // 이미지 추가
            try {
                ImageData imageData = ImageDataFactory.create(book.getThumbnail()); //이미지를 데이터에 저장
                Image image = new Image(imageData);
                image.setAutoScale(true);
                table.addCell(new Cell().add(image).setPadding(5));
            } catch (MalformedURLException e) {
                table.addCell(createCell("이미지 불러오기 실패", false));
            }
        }

        document.add(table);
        document.close();
    }

//맨 윗단 Header이면 회색&폰트 크기변경, 진하게

    private static Cell createCell(String content, boolean isHeader) {
        Paragraph paragraph = new Paragraph(content);
        Cell cell = new Cell().add(paragraph);
        cell.setPadding(5); //여백
        if (isHeader) {
            cell.setBackgroundColor(ColorConstants.LIGHT_GRAY);
            cell.setFontSize(14);
            cell.setBold();
        }
        return cell;
    }
}
```


</div>
</details>



### Ch04. 실전 API 활용하기 (3)





